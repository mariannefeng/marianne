---
import { getCollection, type CollectionEntry } from 'astro:content';
import BaseLayout from '../../layouts/BaseLayout.astro';
import Header from '../../components/Header.astro';
import PortfolioVideo from '../../components/PortfolioVideo.astro';
import { SITE_DESCRIPTION, SITE_TITLE } from '../../consts';
import { sortPortfolioByDate } from '../../portfolio';

type PortfolioEntry = CollectionEntry<'portfolio'>;

const posts = (await getCollection('portfolio')).filter((post: PortfolioEntry) => !post.data.draft).sort(sortPortfolioByDate);
---

<BaseLayout title={SITE_TITLE} description={SITE_DESCRIPTION}>
	<style slot="head">
			header {
				position: relative;
				z-index: 2;
			}
			main {
				margin-top: 2em;
				margin-bottom: 2em;
			}
			ul {
				display: flex;
				flex-wrap: wrap;
				flex-direction: column;
				gap: 4rem;
				list-style-type: none;
				padding: 0;
				position: relative;
				justify-content: center;
				max-width: 600px;
				margin: 0 auto;
			}

			ul li * {
				text-decoration: none;
			}

			ul li {
				display: flex;
				justify-content: space-between;
				align-items: center;
				position: relative;
			}
			.title {
				margin: 0;
				color: rgb(var(--black));
				line-height: 1;
			}

			.tag {
				border-radius: 1em;
				min-width: 5em;
				text-align: center;
				font-size: .9em;
			}

			.tags {
				display: flex;
				gap: 0.5em;
			}

			p.description {
				margin-top: 0;
			}

			a.project-link {
				min-width: 90%;
			}

			a.github-link {
				padding: .5em;
			}

			/* One avatar per row, alternating Namu/Rocky, peeking from the left on hover */
			.floating-avatar {
				position: absolute;
				left: -50px;
				top: 50%;
				transform: translateY(-50%) rotate(270deg);
				width: 25px;
				height: 25px;
				pointer-events: none;
				opacity: 0;
				transition: opacity 0.1s linear;
				z-index: 1;
			}
			ul li:hover .floating-avatar {
				opacity: 1;
			}
		</style>
	<Header />
	<main>
		<section>
			<ul>
				{
					posts.map((post: PortfolioEntry, i: number) => (
						<li>
							<img class="floating-avatar" src={i % 2 === 0 ? '/namu.svg' : '/rocky.svg'} alt="" width="25" height="25" aria-hidden="true" />
							<a class="project-link" href={post.data.url ? post.data.url : `/portfolio/${post.id}/`} target={post.data.url ? "_blank" : "_self"}>
								<p class="description">{post.data.description}</p>
								<div class="tags">
								{post.data.tags?.map((tag) => (
									<span class=`tag tag-${tag}`>{tag}</span>
								))}
								</div>
							</a>

							<a class="github-link" href={post.data.githubUrl} target="_blank" rel="noopener noreferrer"><img src="/github.svg" alt="GitHub" height="24" width="24"/></a>
						</li>
					))
				}
			</ul>
		</section>
	</main>
</BaseLayout>
